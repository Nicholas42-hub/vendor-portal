<div id="ilyg6" class="row sectionBlockLayout text-left">
    <div id="i5cwi" class="container">
      <div class="col-md-12 columnBlockLayout"
        style="flex-grow: 1; display: flex; flex-direction: column; min-width: 250px; word-break: break-word;">
        <div class="form-style-6">
          <form id="VendorOnboardingForm">
            <legend>Vendor Account Set Up Form</legend>
            <h2 class="subtitle">1.General details</h2>
            <div id="trandingentity" class="trandingentity">
              <label for="trandingentity" class="trandingentity">Select Trading Entity(ies):<span
                  class="required-field">*</span></label>
              <div class="grid-entity"><input type="checkbox" id="ALAW" name="trandingentity" value="ALAW"><label
                  for="ALAW">The Trustee for Lagardere / AWPL Trust (ALAW)</label><br><input type="checkbox" id="AUDF"
                  name="trandingentity" value="AUDF"><label for="AUDF">Duty Free Stores Australia Pty Ltd (AUDF) (CNS T1
                  stores only)</label><br><input type="checkbox" id="AUTE" name="trandingentity" value="AUTE"><label
                  for="AUTE">Newslink Pty Ltd (AUTE) (CNS T1 stores only)</label><br></div>
              <div class="grid-entity"><input type="checkbox" id="NZAW" name="trandingentity" value="NZAW"><label
                  for="NZAW">AWPL Retail Solutions Ltd (NZAW)</label><br><input type="checkbox" id="AUPG"
                  name="trandingentity" value="AUPG"><label for="AUPG">The Purely Group Pty Ltd (AUPG)</label><br><input
                  type="checkbox" id="AUAW" name="trandingentity" value="AUAW"><label for="AUAW">The Trustee for AWPL
                  Tango Trust (AUAW)</label><br></div>
              <div class="grid-entity"><input type="checkbox" id="NZDF" name="trandingentity" value="NZDF"><label
                  for="NZDF">Duty Free Stores Wellington Ltd (NZDF)</label><br><input type="checkbox" id="NZTE"
                  name="trandingentity" value="NZTE"><label for="NZTE">LS Travel Retail New Zealand Ltd
                  (NZTE)</label><br><input type="checkbox" id="LSAP" name="trandingentity" value="LSAP"><label
                  for="LSAP">Lagardere Services Asia Pacific Pty Ltd (LSAP)</label><br></div>
            </div>
            <label for="Companycode">Vendor Home Country:<span class="required-field">*</span></label>
            <select id="Companycode" name="Companycode" required>
              <option value="" disabled selected>Select an option</option>
              <option value="Afghanistan">Afghanistan</option>
              <option value="Albania">Albania</option>
              <option value="Algeria">Algeria</option>
              <option value="Andorra">Andorra</option>
              <option value="Angola">Angola</option>
              <option value="Antigua and Barbuda">Antigua and Barbuda</option>
              <option value="Argentina">Argentina</option>
              <option value="Armenia">Armenia</option>
              <option value="Australia">Australia</option>
              <option value="Austria">Austria</option>
              <option value="Azerbaijan">Azerbaijan</option>
              <option value="Bahamas">Bahamas</option>
              <option value="Bahrain">Bahrain</option>
              <option value="Bangladesh">Bangladesh</option>
              <option value="Barbados">Barbados</option>
              <option value="Belarus">Belarus</option>
              <option value="Belgium">Belgium</option>
              <option value="Belize">Belize</option>
              <option value="Benin">Benin</option>
              <option value="Bhutan">Bhutan</option>
              <option value="Bolivia">Bolivia</option>
              <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
              <option value="Botswana">Botswana</option>
              <option value="Brazil">Brazil</option>
              <option value="Brunei">Brunei</option>
              <option value="Bulgaria">Bulgaria</option>
              <option value="Burkina Faso">Burkina Faso</option>
              <option value="Burundi">Burundi</option>
              <option value="Côte d'Ivoire">Côte d'Ivoire</option>
              <option value="Cabo Verde">Cabo Verde</option>
              <option value="Cambodia">Cambodia</option>
              <option value="Cameroon">Cameroon</option>
              <option value="Canada">Canada</option>
              <option value="Central African Republic">Central African Republic</option>
              <option value="Chad">Chad</option>
              <option value="Chile">Chile</option>
              <option value="China">China</option>
              <option value="Colombia">Colombia</option>
              <option value="Comoros">Comoros</option>
              <option value="Congo, Democratic Republic of the">Congo, Democratic Republic of the</option>
              <option value="Congo, Republic of the">Congo, Republic of the</option>
              <option value="Costa Rica">Costa Rica</option>
              <option value="Croatia">Croatia</option>
              <option value="Cuba">Cuba</option>
              <option value="Cyprus">Cyprus</option>
              <option value="Czech Republic">Czech Republic</option>
              <option value="Denmark">Denmark</option>
              <option value="Djibouti">Djibouti</option>
              <option value="Dominica">Dominica</option>
              <option value="Dominican Republic">Dominican Republic</option>
              <option value="Ecuador">Ecuador</option>
              <option value="Egypt">Egypt</option>
              <option value="El Salvador">El Salvador</option>
              <option value="Equatorial Guinea">Equatorial Guinea</option>
              <option value="Eritrea">Eritrea</option>
              <option value="Estonia">Estonia</option>
              <option value="Eswatini">Eswatini</option>
              <option value="Ethiopia">Ethiopia</option>
              <option value="Fiji">Fiji</option>
              <option value="Finland">Finland</option>
              <option value="France">France</option>
              <option value="Gabon">Gabon</option>
              <option value="Gambia">Gambia</option>
              <option value="Georgia">Georgia</option>
              <option value="Germany">Germany</option>
              <option value="Ghana">Ghana</option>
              <option value="Greece">Greece</option>
              <option value="Grenada">Grenada</option>
              <option value="Guatemala">Guatemala</option>
              <option value="Guinea">Guinea</option>
              <option value="Guinea-Bissau">Guinea-Bissau</option>
              <option value="Guyana">Guyana</option>
              <option value="Haiti">Haiti</option>
              <option value="Honduras">Honduras</option>
              <option value="Hungary">Hungary</option>
              <option value="Iceland">Iceland</option>
              <option value="India">India</option>
              <option value="Indonesia">Indonesia</option>
              <option value="Iran">Iran</option>
              <option value="Iraq">Iraq</option>
              <option value="Ireland">Ireland</option>
              <option value="Israel">Israel</option>
              <option value="Italy">Italy</option>
              <option value="Jamaica">Jamaica</option>
              <option value="Japan">Japan</option>
              <option value="Jordan">Jordan</option>
              <option value="Kazakhstan">Kazakhstan</option>
              <option value="Kenya">Kenya</option>
              <option value="Kiribati">Kiribati</option>
              <option value="Kosovo">Kosovo</option>
              <option value="Kuwait">Kuwait</option>
              <option value="Kyrgyzstan">Kyrgyzstan</option>
              <option value="Laos">Laos</option>
              <option value="Latvia">Latvia</option>
              <option value="Lebanon">Lebanon</option>
              <option value="Lesotho">Lesotho</option>
              <option value="Liberia">Liberia</option>
              <option value="Libya">Libya</option>
              <option value="Liechtenstein">Liechtenstein</option>
              <option value="Lithuania">Lithuania</option>
              <option value="Luxembourg">Luxembourg</option>
              <option value="North Macedonia">North Macedonia</option>
              <option value="Madagascar">Madagascar</option>
              <option value="Malawi">Malawi</option>
              <option value="Malaysia">Malaysia</option>
              <option value="Maldives">Maldives</option>
              <option value="Mali">Mali</option>
              <option value="Malta">Malta</option>
              <option value="Marshall Islands">Marshall Islands</option>
              <option value="Mauritania">Mauritania</option>
              <option value="Mauritius">Mauritius</option>
              <option value="Mexico">Mexico</option>
              <option value="Micronesia">Micronesia</option>
              <option value="Moldova">Moldova</option>
              <option value="Monaco">Monaco</option>
              <option value="Mongolia">Mongolia</option>
              <option value="Montenegro">Montenegro</option>
              <option value="Morocco">Morocco</option>
              <option value="Mozambique">Mozambique</option>
              <option value="Myanmar">Myanmar</option>
              <option value="Namibia">Namibia</option>
              <option value="Nauru">Nauru</option>
              <option value="Nepal">Nepal</option>
              <option value="Netherlands">Netherlands</option>
              <option value="New Zealand">New Zealand</option>
              <option value="Nicaragua">Nicaragua</option>
              <option value="Niger">Niger</option>
              <option value="Nigeria">Nigeria</option>
              <option value="North Korea">North Korea</option>
              <option value="Norway">Norway</option>
              <option value="Oman">Oman</option>
              <option value="Pakistan">Pakistan</option>
              <option value="Palau">Palau</option>
              <option value="Panama">Panama</option>
              <option value="Papua New Guinea">Papua New Guinea</option>
              <option value="Paraguay">Paraguay</option>
              <option value="Peru">Peru</option>
              <option value="Philippines">Philippines</option>
              <option value="Poland">Poland</option>
              <option value="Portugal">Portugal</option>
              <option value="Qatar">Qatar</option>
              <option value="Romania">Romania</option>
              <option value="Russia">Russia</option>
              <option value="Rwanda">Rwanda</option>
              <option value="St Kitts and Nevis">St Kitts and Nevis</option>
              <option value="St Lucia">St Lucia</option>
              <option value="St Vincent and the Grenadines">St Vincent and the Grenadines</option>
              <option value="Samoa">Samoa</option>
              <option value="San Marino">San Marino</option>
              <option value="Sao Tome and Principe">Sao Tome and Principe</option>
              <option value="Saudi Arabia">Saudi Arabia</option>
              <option value="Senegal">Senegal</option>
              <option value="Serbia">Serbia</option>
              <option value="Seychelles">Seychelles</option>
              <option value="Sierra Leone">Sierra Leone</option>
              <option value="Singapore">Singapore</option>
              <option value="Slovakia">Slovakia</option>
              <option value="Slovenia">Slovenia</option>
              <option value="Solomon Islands">Solomon Islands</option>
              <option value="Somalia">Somalia</option>
              <option value="South Africa">South Africa</option>
              <option value="South Korea">South Korea</option>
              <option value="South Sudan">South Sudan</option>
              <option value="Spain">Spain</option>
              <option value="Sri Lanka">Sri Lanka</option>
              <option value="Sudan">Sudan</option>
              <option value="Suriname">Suriname</option>
              <option value="Sweden">Sweden</option>
              <option value="Switzerland">Switzerland</option>
              <option value="Syria">Syria</option>
              <option value="Taiwan">Taiwan</option>
              <option value="Tajikistan">Tajikistan</option>
              <option value="Tanzania">Tanzania</option>
              <option value="Thailand">Thailand</option>
              <option value="Timor-Leste">Timor-Leste</option>
              <option value="Togo">Togo</option>
              <option value="Tonga">Tonga</option>
              <option value="Trinidad and Tobago">Trinidad and Tobago</option>
              <option value="Tunisia">Tunisia</option>
              <option value="Turkey">Turkey</option>
              <option value="Turkmenistan">Turkmenistan</option>
              <option value="Tuvalu">Tuvalu</option>
              <option value="Uganda">Uganda</option>
              <option value="Ukraine">Ukraine</option>
              <option value="United Arab Emirates">United Arab Emirates</option>
              <option value="United Kingdom">United Kingdom</option>
              <option value="United States of America">United States of America</option>
              <option value="Uruguay">Uruguay</option>
              <option value="Uzbekistan">Uzbekistan</option>
              <option value="Vanuatu">Vanuatu</option>
              <option value="Vatican City">Vatican City</option>
              <option value="Venezuela">Venezuela</option>
              <option value="Vietnam">Vietnam</option>
              <option value="Yemen">Yemen</option>
              <option value="Zambia">Zambia</option>
              <option value="Zimbabwe">Zimbabwe</option>
            </select>
            <label for="BU">Primary Trading Business Unit:<span class="required-field">*</span></label>
            <select id="BU" name="BU" required="">
              <option value="" disabled="" selected="">Select an option</option>
              <option value="Travel Essentials">Travel Essentials</option>
              <option value="Food Services">Food Services</option>
              <option value="Specialty">Specialty</option>
              <option value="Duty Free">Duty Free</option>
              <option value="Finance">Finance</option>
              <option value="IT">IT</option>
            </select>
            <label for="Email">Email:<span class="required-field">*</span></label>
            <input type="email" id="Email" name="Email"
              title="Please enter a valid email address (e.g., example@domain.com)" required
              pattern="[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}" placeholder="example@domain.com"
              oninput="validateEmail(this)" onblur="validateEmail(this)">
            <div id="emailError" class="error-message"></div>
  
            <!-- <label for="Address">Address:</label>
            <input type="text" id="Address" name="Address" placeholder="Start typing an address..." autocomplete="off"
              class="google-places-autocomplete">
            <div id="address-error" class="error-message"></div> -->
            <label for="Business_name">Business Name:<span class="required-field">*</span></label><input type="text"
              id="Business_name" name="Business_name"><label for="VendorType">Vendor Type:<span
                class="required-field">*</span></label>
            <select id="VendorType" name="VendorType" required onchange="toggleAgreeOverhead_quote()">
              <option value="" disabled selected>Select an option</option>
              <option value="STOCK">Stock</option>
              <option value="OVERHEADS">Overheads</option>
              <option value="OVERHEADANDSTOCK">Overhead and Stock</option>
            </select>
            <!-- <div class="form-group">
              <label for="child_vendor_yn">Child Vendor:<span class="required-field">*</span></label>
              <select id="child_vendor_yn" name="child_vendor_yn"
                onchange="toggleChildVendorSearch(); toggleSubmitButtons();" required>
                <option value="" disabled selected>Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
  
              <div id="child_vendor_search" class="hidden">
                <div class="form-group">
                  <label for="parent_vendor">Parent Vendor:<span class="required-field">*</span></label>
                  <select id="parent_vendor" name="parent_vendor"></select>
                </div>
              </div>
            </div> -->
  
          </form>
        </div>
      </div>
      <div class="col-md-12 columnBlockLayout"
        style="flex-grow: 1; display: flex; flex-direction: column; min-width: 250px; word-break: break-word;">
        <div class="form-style-6">
          <form id="Tradingterm" class="form">
            <h2 class="subtitle">2.Trading Terms</h2>
            <div id="quotesSection">
              <label for="quotes_obtained_yn">Have 2 quotes been obtained?<span class="required-field">*</span></label>
              <select id="quotes_obtained_yn" name="quotes_obtained" onchange="toggleQuotesObtained()">
                <option value="" disabled selected>Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
  
              <div id="quotes_obtained_input" class="hidden">
                <label for="reason">If no, please provide a reason:</label>
                <input type="text" id="reason" name="reason">
              </div>
            </div>
            <div id="back_order">
              <label for="back_order">Allow Back order:</label>
              <div class="dropdown-input">
                <select title="backorderselection" id="back_order_yn" name="back_order_yn">
                  <option value="" disabled="" selected="">Select an option</option>
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="col-md-12 columnBlockLayout"
        style="flex-grow: 1; display: flex; flex-direction: column; min-width: 250px; word-break: break-word;">
        <div class="form-style-6">
          <form id="Supplyterm" class="form">
            <h2 class="subtitle">3.Supply Terms</h2>
            <label for="exclusive_supply">Exclusive supply to LagardereAwpl:<span
                class="required-field">*</span></label></label>
            <div class="dropdown-input">
              <select id="exclusive_supply_yn" name="exclusive_supply_yn" required="">
                <option value="" disabled="" selected="">Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
              <p>Product not supplied to other Airport retailers</p>
            </div>
            <label for="sale_or_return">Sale or return:<span class="required-field">*</span></label>
            <div class="dropdown-input">
              <select id="sale_or_return_yn" name="sale_or_return_yn" required="">
                <option value="" disabled="" selected="">Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>
            <label for="auth_yn">Auth .No Required for Returns:<span class="required-field">*</span></label>
            <div class="dropdown-input">
              <select id="auth_yn" name="auth_yn" required="">
                <option value="" disabled="" selected="">Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>
            <label for="delivery_notice"> Lead time in working days:<span class="required-field">*</span></label><input
              type="number" id="delivery_notice" name="delivery_notice" placeholder="working days" required="">
            <label for="min_order_value">Minimum Order Value:<span class="required-field">*</span></label><input
              type="number" id="min_order_value" name="min_order_value" required="">
            <label for="min_order_quantity">Minimum Order Quantity:<span class="required-field">*</span></label><input
              type="number" id="min_order_quantity" name="min_order_quantity" required="">
            <label for="max_order_value">Maximum Order Value:<span class="required-field">*</span></label><input
              type="number" id="max_order_value" name="max_order_value" required="">
            <label for="other_comments">Other Comments:</label><textarea id="other_comments" name="other_comments"
              class="other_comments"></textarea>
          </form>
        </div>
      </div>
      <div class="col-md-12 columnBlockLayout"
        style="flex-grow: 1; display: flex; flex-direction: column; min-width: 250px; word-break: break-word;">
        <div class="form-style-6">
          <form id="Financialterms" class="form">
            <h2 class="subtitle">4.Financial Terms</h2>
            <label for="payment_terms">Payment terms:<span class="required-field">*</span></label>
            <select title="payment_terms" id="payment_terms" name="payment_terms" required="">
              <option value="" disabled="" selected="">Select an option</option>
              <option value="20 EOM">20 EOM</option>
              <option value="30 DAYS">30 Days</option>
              <option value="60 DAYS">60 Days</option>
              <option value="90 DAYS">90 Days</option>
              <option value="30 EOM">30 EOM</option>
              <option value="60 EOM">30 EOM</option>
              <option value="90 EOM">90 EOM</option>
            </select>
            <p class="notice">Terms set to 20 EOM requires CFO approval</p>
            <div id="order_expiry_days">
              <label for="order_expiry_days">Order Expiry Days:<span class="required-field">*</span></label>
              <input type="number" id="order_expiry_days" name="order_expiry_days" min="1" max="9999" required>
              <label for="gross_margin">Gross Margin:<span class="required-field">*</span></label><input type="text"
                id="gross_margin" name="gross_margin" placeholder="%" required="">
            </div>
            <div>
              <div>
                <label for="invoice_discount">Purchase Discount:<span class="required-field">*</span></label>
                <div class="dropdown-input">
                  <select title="discountselection" id="invoice_discount_yn" name="invoice_discount_yn"
                    onchange="toggleInvoiceDiscount()" required="">
                    <option value="" disabled="" selected="">Select an option</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                  </select>
                  <div id="invoice_discount_input" class="Discount hidden"><input type="text" id="invoice_discount"
                      name="invoice_discount" placeholder="% of net invoiced value / wholesale price"></div>
                </div>
              </div>
              <label for="settlement_discount">Settlement Discount:<span class="required-field">*</span></label>
              <div class="dropdown-input">
                <select title="settlementdiscount" id="settlement_discount_yn" name="settlement_discount_yn"
                  onchange="toggleSettlementDiscount()" required="">
                  <option value="" disabled="" selected="">Select an option</option>
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
                <div id="settlement_discount_input" class="grid_selection hidden">
                  <div><input type="text" id="settlement_discount" name="settlement_discount"
                      placeholder="% of net invoiced value for payment"></div>
                  <div><input type="text" id="settlement_discount_days" name="settlement_discount"
                      placeholder="within ____ days"></div>
                </div>
              </div>
              <div id="rebate">
                <label for="flat_rebate">Flat rebate:<span class="required-field">*</span></label>
                <div class="dropdown-input">
                  <select title="flat_rebate_yn" id="flat_rebate_yn" name="flat_rebate_yn" onchange="toggleFoatRebate()"
                    required="">
                    <option value="" disabled="" selected="">Select an option</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                  </select>
                  <div id="flat_rebate_input" class="grid_selection hidden">
                    <div class="rebate-row">
                      <div><input type="text" id="flat_rebate" name="flat_rebate"
                          placeholder="% of net invoiced value for the"></div>
                      <div><input type="text" id="flat_rebate_dollar" name="flat_rebate_doolar"
                          placeholder="$ of net invoiced value for the"></div>
                      <div>
                        <select id="flat_rebate_term" name="flat_rebate_term">
                          <option value="" disabled="" selected="">Month/Quarter/Year</option>
                          <option value="month">Month</option>
                          <option value="quarter">Quarter</option>
                          <option value="year">Year</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <label for="growth_rebate">Growth rebate:<span class="required-field">*</span></label>
                <div class="dropdown-input">
                  <select id="growth_rebate_yn" name="growth_rebate_yn" onchange="toggleGrowthrebate()" required="">
                    <option value="" disabled="" selected="">Select an option</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                  </select>
                  <div id="growth_rebate_input" class="grid_selection hidden">
                    <!-- The container that will lay its children in one row -->
                    <div class="rebate-row">
                      <input type="text" id="growth_rebate" name="growth_rebate"
                        placeholder="% of net invoiced value for the">
                      <input type="text" id="growth_rebate_dollar" name="growth_rebate_dollar"
                        placeholder="$ of net invoiced value for the">
                      <select id="growth_rebate_term" name="growth_rebate_term">
                        <option value="" disabled selected>Month/Quarter/Year</option>
                        <option value="month">Month</option>
                        <option value="quarter">Quarter</option>
                        <option value="year">Year</option>
                      </select>
                    </div>
                  </div>
                </div>
                <label for="marketing_rebate_yn">Marketing rebate:<span class="required-field">*</span></label>
                <div class="dropdown-input">
                  <select id="marketing_rebate_yn" name="marketing_rebate_yn" required="" onchange="toggleMarketrebate()">
                    <option value="" disabled="" selected="">Select an option</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                  </select>
                  <div id="marketing_rebate_input" class="grid_selection hidden">
                    <div class="rebate-row">
                      <div><input type="text" id="marketing_rebate" name="marketing_rebate"
                          placeholder="% of net invoiced value for the month/quarter/year"></div>
                      <div><input type="text" id="marketing_rebate_dollar" name="marketing_rebate_dollar"
                          placeholder="$ of net invoiced value for the month/quarter/year"></div>
                      <div>
                        <select id="marketing_rebate_term" name="marketing_rebate_term">
                          <option value="" disabled="" selected="">Month/Quarter/Year</option>
                          <option value="month">Month</option>
                          <option value="quarter">Quarter</option>
                          <option value="year">Year</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <label for="promotional_fund_yn">Promotional Fund:</label>
              <div class="dropdown-input">
                <select id="promotional_fund_yn" name="promotional_fund_yn" onchange="togglePromotionalfund()">
                  <option value="" disabled="" selected="">Select an option</option>
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
                <div id="promotional_fund_input" class="grid_selection hidden">
                  <label for="promotional_fund">Enter amount in dollars:</label>
                  <input type="text" id="promotional_fund" name="promotional_fund" placeholder="$0.00">
                </div>
              </div>
            </div>
            <div class="submission">
              <input type="submit" id="regular_submit" value="Send a vendor portal invite" onclick="handleSubmit(event)">
              <input type="submit" id="child_vendor_submit" value="Send to Approval Flow"
                onclick="handleChildVendorSubmit(event)" class="hidden">
            </div>
          </form>
          <!-- Confirmation Popup -->
          <div id="confirmPopup" class="popup">
            <h2>Would you want to proceed?</h2>
            <button type="button" class="btn-yes" onclick="proceedSubmit()">Yes</button>
            <button type="button" class="btn-no" onclick="closeConfirmPopup()">No</button>
          </div>
          <!-- Thank You Popup -->
          <div id="thankYouPopup" class="popup">
            <h2>Thank you!</h2>
            <p>The invitation has been successfully shared. Thanks!</p>
            <button type="button" class="btn-ok" onclick="closeThankYouPopup_vendor_setup()">OK</button>
          </div>
          <!-- Overlay -->
          <div id="popupOverlay" class="popup-overlay"></div>
        </div>
      </div>
    </div>
    <!-- Include Flatpickr CSS --><link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet" type="text/css"><!-- Include Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
      flatpickr("#start_date", {
        altInput: true,
        altFormat: "F j, Y",
        dateFormat: "Y-m-d",
      });
    </script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
  
    <script>
  
      let confirmPopup = document.getElementById("confirmPopup");
      let thankYouPopup = document.getElementById("thankYouPopup");
      let popupOverlay = document.getElementById("popupOverlay");
  
      function openConfirmPopup() {
          confirmPopup.classList.add("open-popup");
          popupOverlay.classList.add("open-popup-overlay");
      }
  
      function closeConfirmPopup() {
          confirmPopup.classList.remove("open-popup");
          popupOverlay.classList.remove("open-popup-overlay");
      }
  
      function proceedSubmit() {
      const confirmPopup = document.getElementById('confirmPopup');
      const thankYouPopup = document.getElementById('thankYouPopup');
      confirmPopup.classList.remove("open-popup");
  
      const currentUserEmail = "{{ user.emailaddress1 }}";
      const businessUnit = document.getElementById('BU').value;
      const isChildVendor = document.getElementById('child_vendor_yn').value === 'yes';
      const parentVendorEmail = isChildVendor ? document.getElementById('parent_vendor').value : null;
  
      const approversUrl = `/_api/crb7c_approverses?$filter=crb7c_businessunit eq '${encodeURIComponent(businessUnit)}'`;
      
      webapi.safeAjax({
          type: "GET",
          url: approversUrl,
          contentType: "application/json",
          headers: {
              "Prefer": "odata.include-annotations=*"
          },
          success: async function(approversData) {
              if (approversData && approversData.value && approversData.value.length > 0) {
                  const approver = approversData.value[0];
                  try {
                      const approverName = await getApproverName(approver.crb7c_approver1);
                      
                      const contactRecord = {
                          emailaddress1: document.getElementById('Email').value,
                          lastname: document.getElementById('Business_name').value,
                          description: document.getElementById('Companycode').value,
                          crb7c_createdvendor:"Yes",
                          crb7c_vendorsetupstatus: "Yes",
                          ...(isChildVendor ? {
                              crb7c_parentvendor: parentVendorEmail,
                              crb7c_statuscode: "Pending Manager Approval",
  
                          } : {
                              crb7c_vendoremailinvitation: "Yes",
                              crb7c_statuscode: "Invitation sent"
                          }),
                          crb7c_vendoremail: document.getElementById('Email').value,
                          crb7c_primarytradingbusinessunit: businessUnit,
                          crb7c_vendortype: document.getElementById('VendorType').value,
                          crb7c_purchasetype: document.getElementById('purchase_type').value,
                          crb7c_barcode: document.getElementById('barcode').value,
                          crb7c_delivery_notice: document.getElementById('delivery_notice').value,
                          crb7c_min_order_value: document.getElementById('min_order_value').value,
                          crb7c_max_order_value: document.getElementById('max_order_value').value,
                          crb7c_exclusivesupply: document.getElementById('exclusive_supply_yn').value,
                          crb7c_salesorreturn: document.getElementById('sale_or_return_yn').value,
                          crb7c_salesorexchange: document.getElementById('sale_or_exchange_yn').value,
                          crb7c_grossmargin: document.getElementById('gross_margin').value,
                          crb7c_agreeddiscount: document.getElementById('agreed_discount').value,
                          crb7c_invoicediscount: document.getElementById('invoice_discount').value,
                          crb7c_settlementdiscount: document.getElementById('settlement_discount').value,
                          crb7c_settlementdiscountdays: document.getElementById('settlement_discount_days').value,
                          crb7c_flatrebate: document.getElementById('flat_rebate').value,
                          crb7c_growthrebate: document.getElementById('growth_rebate').value,
                          crb7c_marketingrebate: document.getElementById('marketing_rebate').value,
                          crb7c_promotionalfund: document.getElementById('promotional_fund').value,
                          adx_createdbyusername: "{{ user.lastname }}",
                          crb7c_createdbyemail: currentUserEmail,
                          crb7c_currentapprover: approver.crb7c_approver1,
                          crb7c_currentapprovername: approverName,
                          crb7c_paymentterms: document.getElementById('payment_terms').value
                      };
  
                      createContact(contactRecord);
                  } catch (error) {
                      console.error("Error in submission process:", error);
                      handleError("Error in submission process: " + error.message);
                  }
              } else {
                  console.error("No approvers found for the business unit");
                  handleError("No approvers found for the selected business unit");
              }
          },
          error: function(xhr, textStatus, errorThrown) {
              console.error("Error fetching approvers:", xhr);
              handleError("Error fetching approver information: " + errorThrown);
          }
      });
  }
  
  
  function getApproverName(email) {
      return new Promise((resolve, reject) => {
          webapi.safeAjax({
              type: "GET",
              url: `/_api/contacts?$select=lastname&$filter=emailaddress1 eq '${encodeURIComponent(email)}'`,
              contentType: "application/json",
              success: function(data) {
                  if (data && data.value && data.value.length > 0) {
                      resolve(data.value[0].lastname);
                  } else {
                      resolve(null);
                  }
              },
              error: function(xhr, textStatus, errorThrown) {
                  console.error("Error fetching approver name:", errorThrown);
                  resolve(null); // Resolve with null instead of rejecting
              }
          });
      });
  }
  
  function createContact(contactRecord) {
      webapi.safeAjax({
          type: "POST",
          url: "/_api/contacts",
          contentType: "application/json",
          data: JSON.stringify(contactRecord),
          success: function(data, textStatus, xhr) {
              const newContactId = xhr.getResponseHeader("entityid");
              console.log("Contact created with ID: " + newContactId);
              showSuccessMessage();
          },
          error: function(xhr, textStatus, errorThrown) {
              console.error("Error creating contact:", xhr);
              handleError("Error creating contact: " + errorThrown);
          }
      });
  }
  function showSuccessMessage() {
      const thankYouPopup = document.getElementById('thankYouPopup');
      const popupOverlay = document.getElementById('popupOverlay');
      thankYouPopup.classList.add("open-popup");
      popupOverlay.classList.add("open-popup-overlay");
  }
  function showFeedback(message) {
      const feedbackMessage = document.getElementById('feedbackMessage');
      const feedbackModal = document.getElementById('feedbackModal');
      feedbackMessage.innerText = message;
      feedbackModal.style.display = 'block';
  }
  
      function closeThankYouPopup_vendor_setup() {
          thankYouPopup.classList.remove("open-popup");
          popupOverlay.classList.remove("open-popup-overlay");
          window.location.href = "https://lagardereawpl-vendorportal.powerappsportals.com/Vendor-Onboarding/";
      }
      function clearErrorStates() {
      // Remove any previous error highlights
      document.querySelectorAll('.error-highlight').forEach(element => {
          element.classList.remove('error-highlight');
      });
  }
  
  async function handleSubmit(event) {
      event.preventDefault();
      let vendorForm = document.getElementById("VendorOnboardingForm");
      let tradingForm = document.getElementById("Tradingterm");
      let supplyForm = document.getElementById("Supplyterm");
      let financialForm = document.getElementById("Financialterms");
      
      // Reset previous error states
      clearErrorStates();
      
      // Check required fields in all forms
      let isValid = validateForm();
      let vendorFormValid = vendorForm.checkValidity();
      let tradingFormValid = tradingForm.checkValidity();
      let financialFormValid = financialForm.checkValidity();
      let supplyFormValid = supplyForm.checkValidity();
  
      if (isValid && vendorFormValid && tradingFormValid && financialFormValid && supplyFormValid) {
          // Check for similar vendors before showing confirmation
          const formData = new FormData(vendorForm);
          const similarityCheck = await checkSimilarVendors(formData);
          
          if (similarityCheck.hasSimilarVendors) {
              showSimilarityWarning(similarityCheck.similarVendors);
          } else {
              openConfirmPopup();
          }
      } else {
          highlightErrors(vendorForm);
          highlightErrors(tradingForm);
          highlightErrors(financialForm);
          highlightErrors(supplyForm);
          scrollToFirstError();
      }
  }
  
  function highlightErrors(form) {
      const elements = form.elements;
      for (let element of elements) {
          if (element.hasAttribute('required') && !element.checkValidity()) {
              // Add error highlight class
              element.classList.add('error-highlight');
              // Add error message below the field if it doesn't exist
              if (!element.nextElementSibling?.classList.contains('error-message_pop_up')) {
                  const errorMsg = document.createElement('div');
                  errorMsg.className = 'error-message_pop_up';
                  errorMsg.textContent = 'This field is required';
                  element.parentNode.insertBefore(errorMsg, element.nextSibling);
              }
          }
      }
  }
  function scrollToFirstError() {
      const firstError = document.querySelector('.error-highlight');
      if (firstError) {
          firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
          firstError.focus();
      }
  }
  function validateForm() {
      var checkboxes = document.getElementsByName('trandingentity');
      var isChecked = false;
      var checkboxContainer = document.querySelector('.grid-entity');
      
      // Remove previous error message if exists
      const existingError = checkboxContainer.querySelector('.error-message');
      if (existingError) {
          existingError.remove();
      }
      
      for (var i = 0; i < checkboxes.length; i++) {
          if (checkboxes[i].checked) {
              isChecked = true;
              break;
          }
      }
      
      if (!isChecked) {
          // Add error message for checkboxes
          const errorMsg = document.createElement('div');
          errorMsg.className = 'error-message_pop_up';
          // errorMsg.textContent = 'Please select at least one trading entity.';
          checkboxContainer.appendChild(errorMsg);
          
          // Scroll to the checkbox section
          checkboxContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
          return false;
      }
      
      return true;
  }
  
  
  $(document).ready(function() {
      // Initialize select2 for child vendor dropdown
      $('#parent_vendor').select2({
          placeholder: "Select an option",
          allowClear: true
      });
  
      // Fetch contacts and populate dropdown
      fetchParentVendors().then(contacts => {
          populateParentVendorDropdown(contacts);
      }).catch(error => {
          console.error("Failed to fetch contacts:", error);
      });
  });
  
  function fetchParentVendors() {
      return new Promise((resolve, reject) => {
          webapi.safeAjax({
              type: "GET",
              url: "/_api/contacts?$select=emailaddress1,lastname,crb7c_vendorsetupstatus",
              contentType: "application/json",
              headers: {
                  "Prefer": "odata.include-annotations=*"
              },
              success: function(data, textStatus, xhr) {
                  console.log("Parent vendors fetched successfully:", data);
                  resolve(data.value);
              },
              error: function(xhr, textStatus, errorThrown) {
                  console.error("Error fetching parent vendors:", errorThrown);
                  reject(errorThrown);
              }
          });
      });
  }
  
  function populateParentVendorDropdown(contacts) {
      // Filter contacts to only include vendors
      const vendors = contacts.filter(contact => 
          contact.crb7c_vendorsetupstatus === "Yes"
      );
  
      const dropdown = $('#parent_vendor');
      dropdown.empty();
      dropdown.append('<option></option>');
  
      vendors.forEach(contact => {
          if (contact.emailaddress1 && contact.lastname) {
              dropdown.append(
                  `<option value="${contact.emailaddress1}">${contact.lastname} (${contact.emailaddress1})</option>`
              );
          }
      });
  
      dropdown.trigger('change');
  }
  
  function validateEmail(input) {
      const email = input.value;
      const errorDiv = document.getElementById('emailError');
      // Updated pattern to require TLD of 2-4 characters
      const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
      
      // Clear previous error state
      input.classList.remove('error');
      errorDiv.style.display = 'none';
      
      // Check if empty
      if (!email) {
          input.classList.add('error');
          errorDiv.textContent = 'Email address is required';
          errorDiv.style.display = 'block';
          return false;
      }
      
      // Additional validation for minimum length of domain parts
      const parts = email.split('@');
      if (parts.length === 2) {
          const [localPart, domain] = parts;
          const domainParts = domain.split('.');
          
          // Check domain format
          if (domainParts.length < 2 || 
              domainParts[domainParts.length - 1].length < 2 || 
              domainParts[domainParts.length - 1].length > 4) {
              input.classList.add('error');
              errorDiv.textContent = 'Please enter a valid email domain (e.g., .com, .org, .edu)';
              errorDiv.style.display = 'block';
              return false;
          }
      }
      
      // Check overall format
      if (!emailPattern.test(email)) {
          input.classList.add('error');
          errorDiv.textContent = 'Please enter a valid email address (e.g., example@domain.com)';
          errorDiv.style.display = 'block';
          return false;
      }
      
      return true;
  }
  
  async function handleChildVendorSubmit(event) {
      event.preventDefault();
      let vendorForm = document.getElementById("VendorOnboardingForm");
      let tradingForm = document.getElementById("Tradingterm");
      let supplyForm = document.getElementById("Supplyterm");
      let financialForm = document.getElementById("Financialterms");
      
      clearErrorStates();
      
      let isValid = validateForm();
      let vendorFormValid = vendorForm.checkValidity();
      let tradingFormValid = tradingForm.checkValidity();
      let supplyFormValid = supplyForm.checkValidity();
      let financialFormValid = financialForm.checkValidity();
  
      if (isValid && vendorFormValid && tradingFormValid && supplyFormValid && financialFormValid) {
          const formData = new FormData(vendorForm);
          const similarityCheck = await checkSimilarVendors(formData);
          
          if (similarityCheck.hasSimilarVendors) {
              showSimilarityWarning(similarityCheck.similarVendors);
          } else {
              openConfirmPopup();
          }
      } else {
          highlightErrors(vendorForm);
          highlightErrors(tradingForm);
          highlightErrors(supplyForm);
          highlightErrors(financialForm);
          scrollToFirstError();
      }
  }
  
  (function(webapi, $){
    function safeAjax(ajaxOptions) {
        var deferredAjax = $.Deferred();

        shell.getTokenDeferred().done(function (token) {
            // add headers for AJAX
            if (!ajaxOptions.headers) {
                $.extend(ajaxOptions, {
                    headers: {
                        "__RequestVerificationToken": token
                    }
                }); 
            } else {
                ajaxOptions.headers["__RequestVerificationToken"] = token;
            }
            $.ajax(ajaxOptions)
                .done(function(data, textStatus, jqXHR) {
                    validateLoginSession(data, textStatus, jqXHR, deferredAjax.resolve);
                }).fail(deferredAjax.reject); //AJAX
        }).fail(function () {
            deferredAjax.rejectWith(this, arguments); // on token failure pass the token AJAX and args
        });

        return deferredAjax.promise();	
    }
    webapi.safeAjax = safeAjax;
})(window.webapi = window.webapi || {}, jQuery);

function toggleQuotesObtained() {
  const quotesDropdown = document.getElementById('quotes_obtained_yn');
  const quotesInput = document.getElementById('quotes_obtained_input');
  const reasonInput = document.getElementById('reason');
  const reasonLabel = document.querySelector('label[for="reason"]');

  if (quotesDropdown.value === 'no') {
    // Show the reason input and make it required
    quotesInput.classList.remove('hidden');
    quotesDropdown.setAttribute('required', '');
    reasonInput.setAttribute('required', '');
    
    // Add required indicator to reason label if not present
    if (!reasonLabel.querySelector('.required-field')) {
      const requiredSpan = document.createElement('span');
      requiredSpan.className = 'required-field';
      requiredSpan.textContent = '*';
      reasonLabel.innerHTML = 'If no, please provide a reason:' + requiredSpan.outerHTML;
    }
  } else {
    // Hide the reason input and remove required attributes
    quotesInput.classList.add('hidden');
    reasonInput.removeAttribute('required');
    reasonInput.value = ''; // Clear the input value
    quotesDropdown.setCustomValidity('');
    
    // Reset the label to original state
    reasonLabel.innerHTML = 'If no, please provide a reason:';
  }
}

function toggleAgreeOverhead_quote() {
  const vendorType = document.getElementById('VendorType');
  const quotesSection = document.getElementById('quotesSection');
  const quotesDropdown = document.getElementById('quotes_obtained_yn');
  const reasonInput = document.getElementById('reason');
  const backorder = document.getElementById('back_order')
  const order_expiry_days = document.getElementById('order_expiry_days')
  const rebate = document.getElementById('rebate')
  if (vendorType.value === 'STOCK') {
    quotesSection.classList.add('hidden');
    quotesDropdown.removeAttribute('required');
    reasonInput.removeAttribute('required');
  } else {
    quotesSection.classList.remove('hidden');
    quotesDropdown.setAttribute('required', '');
  }
  if (vendorType.value === 'OVERHEADS') {
    backorder.classList.add('hidden');
    rebate.classList.add('hidden');
    order_expiry_days.classList.add('hidden');
    rebate.removeAttribute('required');
    order_expiry_days.removeAttribute('required');
    backorder.removeAttribute('required');
    
  } else {
    backorder.classList.remove('hidden');
    rebate.classList.remove('hidden');
    order_expiry_days.classList.remove('hidden');
    backorder.setAttribute('required', '');
    order_expiry_days.setAttribute('required', '');
    rebate.setAttribute('required', '');
  }
}


  // Ensure the input field is hidden initially
  document.addEventListener('DOMContentLoaded', () => {
    toggleQuotesObtained();
  });
 
  function toggleAgreeDiscount() {
    const quotesDropdown = document.getElementById('agreed_discount_selection_yn');
    const quotesInput = document.getElementById('agreed_discount_input');

    if (quotesDropdown.value === 'yes') {
      quotesInput.classList.remove('hidden');
    } else {
      quotesInput.classList.add('hidden');
    }
  }
  // Ensure the input field is hidden initially
  document.addEventListener('DOMContentLoaded', () => {
    toggleQuotesObtained();
  });


    function toggleInvoiceDiscount() {
      const discountDropdown = document.getElementById('invoice_discount_yn');
      const discountInput = document.getElementById('invoice_discount_input');

      if (discountDropdown.value === 'yes') {
        discountInput.classList.remove('hidden');
      } else {
        discountInput.classList.add('hidden');
      }
    }

    // Ensure the input field is hidden initially
    document.addEventListener('DOMContentLoaded', () => {
      toggleInvoiceDiscount();
    });

    function toggleSettlementDiscount() {
        const discountDropdown = document.getElementById('settlement_discount_yn');
        const discountInput = document.getElementById('settlement_discount_input');
  
        if (discountDropdown.value === 'yes') {
          discountInput.classList.remove('hidden');
        } else {
          discountInput.classList.add('hidden');
        }
      }
  
      // Ensure the input field is hidden initially
      document.addEventListener('DOMContentLoaded', () => {
        toggleSettlementDiscount();
      });
  
      function toggleFoatRebate() {
        const discountDropdown = document.getElementById('flat_rebate_yn');
        const discountInput = document.getElementById('flat_rebate_input');
  
        if (discountDropdown.value === 'yes') {
          discountInput.classList.remove('hidden');
        } else {
          discountInput.classList.add('hidden');
        }
      }
  
      // Ensure the input field is hidden initially
      document.addEventListener('DOMContentLoaded', () => {
        toggleSettlementDiscount();
      });


      function toggleGrowthrebate() {
        const discountDropdown = document.getElementById('growth_rebate_yn');
        const discountInput = document.getElementById('growth_rebate_input');
  
        if (discountDropdown.value === 'yes') {
          discountInput.classList.remove('hidden');
        } else {
          discountInput.classList.add('hidden');
        }
      }
  
      // Ensure the input field is hidden initially
      document.addEventListener('DOMContentLoaded', () => {
        toggleSettlementDiscount();
      });


      function toggleFiststoreranging() {
        const discountDropdown = document.getElementById('first_store_ranging_yn');
        const discountInput = document.getElementById('first_store_ranging_input');
  
        if (discountDropdown.value === 'yes') {
          discountInput.classList.remove('hidden');
        } else {
          discountInput.classList.add('hidden');
        }
      }
  
      // Ensure the input field is hidden initially
      document.addEventListener('DOMContentLoaded', () => {
        toggleSettlementDiscount();
      });


      function toggleNewstorebuild() {
        const discountDropdown = document.getElementById('new_store_build_yn');
        const discountInput = document.getElementById('new_store_build_input');
  
        if (discountDropdown.value === 'yes') {
          discountInput.classList.remove('hidden');
        } else {
          discountInput.classList.add('hidden');
        }
      }
  
      // Ensure the input field is hidden initially
      document.addEventListener('DOMContentLoaded', () => {
        toggleSettlementDiscount();
      });

      function toggleMarketrebate() {
        const discountDropdown = document.getElementById('marketing_rebate_yn');
        const discountInput = document.getElementById('marketing_rebate_input');
  
        if (discountDropdown.value === 'yes') {
          discountInput.classList.remove('hidden');
        } else {
          discountInput.classList.add('hidden');
        }
      }
  
      // Ensure the input field is hidden initially
      document.addEventListener('DOMContentLoaded', () => {
        toggleSettlementDiscount();
      });

      function togglePromotionalfund() {
        const discountDropdown = document.getElementById('promotional_fund_yn');
        const discountInput = document.getElementById('promotional_fund_input');
  
        if (discountDropdown.value === 'yes') {
          discountInput.classList.remove('hidden');
        } else {
          discountInput.classList.add('hidden');
        }
      }
  
      // Ensure the input field is hidden initially
      document.addEventListener('DOMContentLoaded', () => {
        toggleSettlementDiscount();
      });

      function toggleChildVendorSearch() {
        const childVendorSelect = document.getElementById('child_vendor_yn');
        const searchSection = document.getElementById('child_vendor_search');
        const parentVendorSelect = document.getElementById('parent_vendor');
        
        if (childVendorSelect.value === 'yes') {
            searchSection.classList.remove('hidden');
            parentVendorSelect.setAttribute('required', '');
            
            // Refresh Select2
            $('#parent_vendor').select2({
                placeholder: "Select an option",
                allowClear: true
            });
        } else {
            searchSection.classList.add('hidden');
            parentVendorSelect.removeAttribute('required');
            $('#parent_vendor').val(null).trigger('change');
        }
    }

      // function loadParentVendors() {
      //   const searchSelect = document.getElementById('parent_vendor_search');
        
      //   // Fetch contacts from the contacts table
      //   webapi.safeAjax({
      //     type: "GET",
      //     url: "/_api/contacts?$select=contactid,fullname",
      //     contentType: "application/json",
      //     success: function(response) {
      //       // Clear existing options except the first one
      //       searchSelect.innerHTML = '<option value="" disabled selected>Select a parent vendor</option>';
            
      //       if (response.value && response.value.length > 0) {
      //         // Sort contacts by fullname
      //         response.value.sort((a, b) => a.fullname.localeCompare(b.fullname));
              
      //         // Add each contact as an option
      //         response.value.forEach(contact => {
      //           const option = document.createElement('option');
      //           option.value = contact.contactid;
      //           option.textContent = contact.fullname;
      //           searchSelect.appendChild(option);
      //         });
      //       }
      //     },
      //     error: function(xhr, textStatus, errorThrown) {
      //       console.error('Error loading parent vendors:', errorThrown);
      //     }
      //   });
      // }

      function toggleSubmitButtons() {
        const childVendorSelect = document.getElementById('child_vendor_yn');
        const regularSubmit = document.getElementById('regular_submit');
        const childVendorSubmit = document.getElementById('child_vendor_submit');
        
        if (childVendorSelect.value === 'yes') {
          regularSubmit.classList.add('hidden');
          childVendorSubmit.classList.remove('hidden');
        } else {
          regularSubmit.classList.remove('hidden');
          childVendorSubmit.classList.add('hidden');
        }
      }


      async function checkSimilarVendors(formData) {
        try {
            const response = await webapi.safeAjax({
                type: "GET",
                url: "/_api/contacts?$select=emailaddress1,lastname,description,crb7c_primarytradingbusinessunit,crb7c_vendortype,crb7c_createdvendor",
                contentType: "application/json",
                headers: {
                    "Prefer": "odata.include-annotations=*"
                }
            });
    
            if (!response.value) return { hasSimilarVendors: false };
    
            const existingVendors = response.value.filter(v => v.crb7c_createdvendor === "Yes");
            const similarities = [];
    
            for (const vendor of existingVendors) {
                const similarityScore = calculateVendorSimilarity(formData, vendor);
                if (similarityScore >= 0.7) { // 70% similarity threshold
                    similarities.push({
                        vendor,
                        score: similarityScore,
                        matchedCriteria: getMatchedCriteria(formData, vendor)
                    });
                }
            }
    
            return {
                hasSimilarVendors: similarities.length > 0,
                similarVendors: similarities.sort((a, b) => b.score - a.score)
            };
        } catch (error) {
            console.error("Error checking similar vendors:", error);
            return { hasSimilarVendors: false };
        }
    }
    
    function calculateVendorSimilarity(formData, existingVendor) {
        let score = 0;
        let totalWeight = 0;
    
        // Business name similarity (weight: 0.3)
        const businessNameSimilarity = calculateStringSimilarity(
            formData.get('Business_name').toLowerCase(),
            existingVendor.lastname.toLowerCase()
        );
        score += businessNameSimilarity * 0.3;
        totalWeight += 0.3;
    
        // Email domain similarity (weight: 0.2)
        const emailDomain1 = formData.get('Email').split('@')[1];
        const emailDomain2 = existingVendor.emailaddress1.split('@')[1];
        if (emailDomain1 === emailDomain2) {
            score += 0.2;
        }
        totalWeight += 0.2;
    
        // Business unit match (weight: 0.2)
        if (formData.get('BU') === existingVendor.crb7c_primarytradingbusinessunit) {
            score += 0.2;
        }
        totalWeight += 0.2;
    
        // Vendor type match (weight: 0.2)
        if (formData.get('VendorType') === existingVendor.crb7c_vendortype) {
            score += 0.2;
        }
        totalWeight += 0.2;
    
        // Home country match (weight: 0.1)
        if (formData.get('Companycode') === existingVendor.description) {
            score += 0.1;
        }
        totalWeight += 0.1;
    
        return score / totalWeight;
    }
    
    function calculateStringSimilarity(str1, str2) {
        if (str1 === str2) return 1;
        if (str1.length === 0 || str2.length === 0) return 0;
    
        const len1 = str1.length;
        const len2 = str2.length;
        const matrix = Array(len1 + 1).fill().map(() => Array(len2 + 1).fill(0));
    
        for (let i = 0; i <= len1; i++) matrix[i][0] = i;
        for (let j = 0; j <= len2; j++) matrix[0][j] = j;
    
        for (let i = 1; i <= len1; i++) {
            for (let j = 1; j <= len2; j++) {
                const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;
                matrix[i][j] = Math.min(
                    matrix[i - 1][j] + 1,
                    matrix[i][j - 1] + 1,
                    matrix[i - 1][j - 1] + cost
                );
            }
        }
    
        return 1 - (matrix[len1][len2] / Math.max(len1, len2));
    }
    
    function getMatchedCriteria(formData, vendor) {
        const matches = [];
    
        // Business name similarity check
        if (calculateStringSimilarity(
            formData.get('Business_name').toLowerCase(),
            vendor.lastname.toLowerCase()
        ) > 0.8) {
            matches.push('Similar business name');
        }
    
        // Email domain match
        if (formData.get('Email').split('@')[1] === vendor.emailaddress1.split('@')[1]) {
            matches.push('Same email domain');
        }
    
        // Business unit match
        if (formData.get('BU') === vendor.crb7c_primarytradingbusinessunit) {
            matches.push('Same business unit');
        }
    
        // Vendor type match
        if (formData.get('VendorType') === vendor.crb7c_vendortype) {
            matches.push('Same vendor type');
        }
    
        // Home country match
        if (formData.get('Companycode') === vendor.description) {
            matches.push('Same home country');
        }
    
        return matches;
    }
    
    function showSimilarityWarning(similarities) {
      const warningDiv = document.createElement('div');
      warningDiv.className = 'popup';
      warningDiv.id = 'similarityWarning';
      warningDiv.innerHTML = `
          <h2>Potential Similar Vendors Found</h2>
          <div class="similarity-content">
              <p>We found existing vendors that are similar to the one you're trying to create:</p>
              <ul>
                  ${similarities.map(sim => `
                      <li>
                          <strong>${sim.vendor.lastname}</strong>
                          <br>
                          Email: ${sim.vendor.emailaddress1}
                          <br>
                          Similarity: ${Math.round(sim.score * 100)}%
                          <br>
                          Matches: ${sim.matchedCriteria.join(', ')}
                      </li>
                  `).join('')}
              </ul>
              <p>Do you still want to proceed with creating this vendor?</p>
              <div class="button-group" style="display: flex; gap: 10px; justify-content: center;">
                  <button 
                      type="button" 
                      class="btn-yes" 
                      onclick="proceedAfterWarning()"
                      style="min-width: 150px; padding: 10px 20px; font-size: 16px; border-radius: 5px; border: none; background-color: #4CAF50; color: white; cursor: pointer;"
                  >Yes, Proceed</button>
                  <button 
                      type="button" 
                      class="btn-no" 
                      onclick="closeSimilarityWarning()"
                      style="min-width: 150px; padding: 10px 20px; font-size: 16px; border-radius: 5px; border: none; background-color: #f44336; color: white; cursor: pointer;"
                  >No, Cancel</button>
              </div>
          </div>
      `;
      
      document.body.appendChild(warningDiv);
      document.getElementById('popupOverlay').classList.add('open-popup-overlay');
      warningDiv.classList.add('open-popup');
  }
    
    function closeSimilarityWarning() {
        const warning = document.getElementById('similarityWarning');
        if (warning) {
            warning.classList.remove('open-popup');
            warning.remove();
        }
        document.getElementById('popupOverlay').classList.remove('open-popup-overlay');
    }
    
    function proceedAfterWarning() {
        closeSimilarityWarning();
        openConfirmPopup();
    }


let googlePlacesAutocomplete;

function initializeGooglePlaces() {
    const addressInput = document.getElementById('Address');
    if (!addressInput) return;

    // Configure autocomplete options
    const options = {
        componentRestrictions: { country: ['au', 'nz'] }, // Restrict to Australia and New Zealand
        fields: ['address_components', 'formatted_address', 'geometry'],
        types: ['address']
    };

    // Initialize Google Places Autocomplete
    googlePlacesAutocomplete = new google.maps.places.Autocomplete(addressInput, options);

    // Add place_changed event listener
    googlePlacesAutocomplete.addListener('place_changed', handlePlaceSelect);

    // Add input event listener for error handling
    addressInput.addEventListener('input', function() {
        const errorDiv = document.getElementById('address-error');
        if (errorDiv) errorDiv.style.display = 'none';
    });
}

function handlePlaceSelect() {
    const place = googlePlacesAutocomplete.getPlace();
    const addressInput = document.getElementById('Address');
    
    if (!place.geometry) {
        showAddressError('Please select an address from the dropdown list');
        return;
    }

    // Parse address components
    let streetNumber = '';
    let route = '';
    let locality = '';
    let area = '';
    let country = '';
    let postcode = '';

    for (const component of place.address_components) {
        const type = component.types[0];
        switch (type) {
            case 'street_number':
                streetNumber = component.long_name;
                break;
            case 'route':
                route = component.long_name;
                break;
            case 'locality':
                locality = component.long_name;
                break;
            case 'administrative_area_level_1':
                area = component.short_name;
                break;
            case 'country':
                country = component.long_name;
                break;
            case 'postal_code':
                postcode = component.long_name;
                break;
        }
    }

    // Set the full formatted address
    addressInput.value = place.formatted_address;

    // Auto-select country in vendor form if applicable
    const countrySelect = document.getElementById('Companycode');
    if (countrySelect && country) {
        if (country === 'Australia') {
            countrySelect.value = 'Australia';
        } else if (country === 'New Zealand') {
            countrySelect.value = 'New Zealand';
        } else {
            countrySelect.value = 'Overseas';
        }
    }
}

function showAddressError(message) {
    const errorDiv = document.getElementById('address-error');
    if (errorDiv) {
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
    }
}

// Initialize Google Places when the page loads
document.addEventListener('DOMContentLoaded', function() {
    initializeGooglePlaces();
});

// Also add this to your existing handleSubmit and handleChildVendorSubmit functions
const validateAddress = () => {
    const addressInput = document.getElementById('Address');
    if (addressInput && addressInput.value.trim() === '') {
        showAddressError('Please enter an address');
        return false;
    }
    return true;
};
  // </script>
  
    </script>
  </div>
<style>
  /* Container for the form */
.sectionBlockLayout {
    display: flex;
    flex-wrap: wrap;
    margin: 0;
    min-height: auto;
    padding: 8px;
  }
  
  /* Container for the form elements */
  .container {
    padding: 0;
    display: flex;
    flex-wrap: wrap;
  }
  
  /* Column layout for the form elements */
  .columnBlockLayout {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    min-width: 250px;
    word-break: break-word;
    margin-top: 0px !important;
    margin-bottom: 0px !important;
  }
  
  /* Style for the form */
  .form-style-6 {
    background: #f7f7f7;
    padding: 20px;
    margin: 10px 0;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    width: 100%;
  }
  
  /* Style for the form legend */
  .form-style-6 legend {
    font-family:  -apple-system, "system-ui", "Segoe UI", Roboto, Oxygen, Ubuntu, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
    font-size: 24px;
    font-weight: 800;
    /* margin-bottom: 25px; */
    color: rgb(31, 31, 35);
  }
  .form-style-6 .subtitle,.form-style-6 .subtitle_sed  {
    font-size: 1.2em;
    box-sizing: border-box;
    color: rgb(31, 31, 35);
    cursor: default;
    display: block;
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, Oxygen, Ubuntu, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
    font-weight: 600;
    height: 20px;
    letter-spacing: normal;
    line-height: 20px;
    margin-left: 0;
    margin-right: 0;
    margin-top: 0;
    overflow-x: visible;
    overflow-y: visible;
    text-decoration-color: rgb(31, 31, 35);
    text-decoration-line: none;
    text-decoration-style: solid;
    text-decoration-thickness: auto;
    text-overflow: clip;
    text-rendering: optimizeLegibility;
    text-size-adjust: 100%;
    text-underline-position: from-font;
    width: 538px;
    word-break: break-word;
    -webkit-font-smoothing: antialiased;
    margin-bottom: 10px;
    margin-top: 20px;
  }
  
  .subtitle{
    margin-top: 10px !important;
    margin-bottom: 10px !important;
  }
  .form-style-6 {
    font-size: 1em;
  
  }
  .subtitle_sed{
    font-size: 1.1em !important;
    margin-bottom: 10px !important;
    margin-top: 30px !important;
  }
  /* Style for form labels */
  .form-style-6 label {
    box-sizing: border-box;
    color: rgb(31, 31, 35);
    cursor: default;
    display: block;
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, Oxygen, Ubuntu, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
    font-size: 12px;
    font-weight: 600;
    height: 20px;
    letter-spacing: normal;
    line-height: 20px;
    margin-bottom: 4px;
    margin-left: 0;
    margin-right: 0;
    margin-top: 0;
    overflow-x: visible;
    overflow-y: visible;
    text-decoration-color: rgb(31, 31, 35);
    text-decoration-line: none;
    text-decoration-style: solid;
    text-decoration-thickness: auto;
    text-overflow: clip;
    text-rendering: optimizeLegibility;
    text-size-adjust: 100%;
    text-underline-position: from-font;
    width: 538px;
    word-break: break-word;
    -webkit-font-smoothing: antialiased;
  }
  
  
  /* Style for form inputs */
  .form-style-6 input[type="text"],
  .form-style-6 input[type="number"],
  .form-style-6 input[type="email"],
  .form-style-6 select,
  .form-style-6 input[type="submit"] {
    display: block;
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
  }
  
  /* Style for submit button */
  .form-style-6 input[type="submit"] {
    background-color: #4CAF50; /* Green */
    color: white;
    border: none;
    cursor: pointer;
  }
  
  .form-style-6 input[type="submit"]:hover {
    background-color: #45a049;
  }
  
  /* Style for code input */
  .vendor-code {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }
  
  .bank-code label {
    margin-right: 10px;
    min-width: 400px; /* Adjust this value as needed */
  }
  
  .bank-code {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }
  
  .vendor-code label {
    margin-right: 10px;
    min-width: 400px; /* Adjust this value as needed */
  }
  
  .code-input {
    display: flex;
    gap: 5px; /* Space between input boxes */
  }
  
  .code-box {
    width: 10px; /* Reduced size */
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    text-align: center;
    box-sizing: border-box;
  }
  
  .code-input_22 {
    display: flex;
    gap: 5px; /* Space between input boxes */
  }
  
  .required-field {
    color: red;
    margin-left: 5px;
  }
  
  .hidden{
  
    display: none;
  }
  
  .dropdown{
    align-items: center;
    box-sizing: border-box;
    color: rgb(31, 31, 35);
    cursor: pointer;
    display: flex;
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, Oxygen, Ubuntu, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
    font-feature-settings: normal;
    font-kerning: auto;
    font-optical-sizing: auto;
    font-size: 14px;
    font-stretch: 100%;
    font-style: normal;
    font-variant-alternates: normal;
    font-variant-caps: normal;
    font-variant-east-asian: normal;
    font-variant-ligatures: normal;
    font-variant-numeric: normal;
    font-variant-position: normal;
    font-variation-settings: normal;
    font-weight: 600;
    height: 24px;
    justify-content: space-between;
    letter-spacing: normal;
    line-height: 24px;
    margin: 0;
    overflow-x: hidden;
    overflow-y: hidden;
    text-align: center;
    text-indent: 0px;
    text-overflow: ellipsis;
    text-rendering: optimizeLegibility;
    text-shadow: none;
    text-size-adjust: 100%;
    text-transform: none;
    text-underline-position: from-font;
    text-wrap: nowrap;
    white-space-collapse: preserve;
    width: 518px;
    word-break: break-word;
    word-spacing: 0px;
    -webkit-font-smoothing: antialiased;
  }
  
  .grid_selection{
    display: grid;
    grid-template-columns: 300px 300px; /* Two equal columns */
    gap: 40px; /* Space between columns */
    max-width: 800px; /* Adjusts width of the form */
    vertical-align: top;
  }
  
  .other_comments{
    width: 100%;
    height: 150px;
    border-radius: 4px;
  
  }
  
  .popup {
    width: 400px;
    background: #fff;
    border-radius: 6px;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.1);
    text-align: center;
    padding: 30px;
    color: #333;
    visibility: hidden;
    transition: transform 0.4s, top 0.4s;
    z-index: 1000; /* Ensure the popup is above other elements */
  }
  
  .open-popup {
    visibility: visible;
    top: 50%;
    transform: translate(-50%, -50%) scale(1);
  }
  
  
  .popup .button-container {
    display: flex;
    justify-content: space-between;
  }
  
  .popup button {
    width: 100px;
    padding: 10px;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
  }
  
  .popup button.btn-yes {
    background-color: #4CAF50;
  }
  .popup button.btn-ok {
    background-color: #4CAF50;
  }
  .popup button.btn-no {
    background-color: #FF0000 !important;
  }
  .popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    visibility: hidden;
    z-index: 999; /* Ensure the overlay is just below the popup */
  }
  
  .open-popup-overlay {
    visibility: visible;
  }
  .popup img{
    width: 100px;
    margin-top: -250px;
    border-radius: 50%;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  }
  
  .popup h2 {
    font-size: 20px !important;
    font-weight: 500;
    margin: 30px 0 10px;
  }
  
  /* Add responsiveness for smaller screens */
  @media (max-width: 600px) {
    .columnBlockLayout {
      min-width: 100%;
    }
  
    .form-style-6 {
      padding: 15px;
    }
  
    .code-input {
      justify-content: flex-start;
    }
  
    .vendor-code {
      flex-direction: column;
      align-items: flex-start;
    }
  
    .bank-code {
      flex-direction: column;
      align-items: flex-start;
    }
  
    .vendor-code label {
      margin-bottom: 5px;
    }
    .bank-code label {
      margin-bottom: 5px;
    }
  }
  
  .grid-entity{
    width: 100% !important;
    height: 30px !important;
    display: flex;
  }
  .grid-entity label {
    display: flex;
    align-items: center;
    font-size: 9px;
  }
  
  .trandingentity label{
    margin-bottom: 10px !important;
  }
  
  .grid-entity input[type="checkbox"] {
    margin-right: 8px; /* Adjust the spacing as needed */
    transform: translateY(-8px) !important; /* Adjust this value to align vertically */
  }
  
  
  .submission{
    font-weight: bold !important;
  }
  .error-highlight {
    border: 2px solid #ff0000 !important;
    background-color: #fff0f0 !important;
  }
  
  .error-message_pop_up {
    color: #FF0000 !important;
    font-size: 0.8em;
    margin-top: 4px;
    display: block;
  }
  
  /* Add animation for error highlight */
  @keyframes errorShake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
  }
  
  .error-highlight {
    animation: errorShake 0.4s ease-in-out;
  }
  
  .error-message {
    color: #ff0000 !important;
    font-size: 12px;
    margin-top: 5px;
    display: none;
  }
  
  input.error {
    border-color: #ff0000 !important;
  }
  
  /* Style for the error state on focus */
  input.error:focus {
    border-color: #ff0000 !important;
    outline-color: #ff0000 !important;
    box-shadow: 0 0 5px rgba(255, 0, 0, 0.2);
  }
  
  .google-places-autocomplete {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
    transition: border-color 0.2s;
  }
  
  .google-places-autocomplete:focus {
    border-color: #4CAF50;
    outline: none;
    box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
  }
  
  .pac-container {
    background-color: #fff;
    border-radius: 4px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    font-family: Arial, sans-serif;
    margin-top: 2px;
    z-index: 10000;
  }
  
  .pac-item {
    padding: 8px 12px;
    cursor: pointer;
    font-size: 14px;
    border-top: 1px solid #e6e6e6;
  }
  
  .pac-item:hover {
    background-color: #f5f5f5;
  }
  
  .pac-item-selected {
    background-color: #f5f5f5;
  }
  
  .pac-matched {
    font-weight: bold;
  }
  
  .error-message {
    color: #dc3545;
    font-size: 12px;
    margin-top: 4px;
    display: none;
  }
  
  .rebate-row {
    display: flex;
    justify-content: space-between; /* Distribute items horizontally */
    align-items: center;            /* Vertically center the items */
    gap: 10px;                      /* Horizontal space between items */
    margin-top: 8px;                /* Optional spacing above the row */
  }
  
  .rebate-row > * {
    flex: 1;                        /* Let each item expand evenly */
    min-width: 240px;               /* Ensure a minimum width */
    margin: 0 5px;                  /* Horizontal margin inside each flex item */
  }
</style>